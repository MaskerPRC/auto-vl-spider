!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FinderLibrary=t():e.FinderLibrary=t()}(this,(()=>(()=>{"use strict";let e,t,n;function r(t,r,l){let i=null,a=[],y=t,g=0;for(;y;){const t=(new Date).getTime()-n.getTime();if(void 0!==e.timeoutMs&&t>e.timeoutMs)throw new Error(`Timeout: Can't find a unique selector after ${t}ms`);let w=h(u(y))||h(...c(y))||h(...s(y))||h(f(y))||[{name:"*",penalty:3}];const N=m(y);if("all"==r)N&&(w=w.concat(w.filter(p).map((e=>d(e,N)))));else if("two"==r)w=w.slice(0,1),N&&(w=w.concat(w.filter(p).map((e=>d(e,N)))));else if("one"==r){const[e]=w=w.slice(0,1);N&&p(e)&&(w=[d(e,N)])}else"none"==r&&(w=[{name:"*",penalty:3}],N&&(w=[d(w[0],N)]));for(let e of w)e.level=g;if(a.push(w),a.length>=e.seedMinLength&&(i=o(a,l),i))break;y=y.parentElement,g++}return i||(i=o(a,l)),!i&&l?l():i}function o(t,n){const r=w(g(t));if(r.length>e.threshold)return n?n():null;for(let e of r)if(a(e))return e;return null}function l(e){let t=e[0],n=t.name;for(let r=1;r<e.length;r++){const o=e[r].level||0;n=t.level===o-1?`${e[r].name} > ${n}`:`${e[r].name} ${n}`,t=e[r]}return n}function i(e){return e.map((e=>e.penalty)).reduce(((e,t)=>e+t),0)}function a(e){const n=l(e);switch(t.querySelectorAll(n).length){case 0:throw new Error(`Can't select any node with this selector: ${n}`);case 1:return!0;default:return!1}}function u(t){const n=t.getAttribute("id");return n&&e.idName(n)?{name:"#"+CSS.escape(n),penalty:0}:null}function c(t){const n=Array.from(t.attributes).filter((t=>e.attr(t.name,t.value)));return n.map((e=>({name:`[${CSS.escape(e.name)}="${CSS.escape(e.value)}"]`,penalty:.5})))}function s(t){return Array.from(t.classList).filter(e.className).map((e=>({name:"."+CSS.escape(e),penalty:1})))}function f(t){const n=t.tagName.toLowerCase();return e.tagName(n)?{name:n,penalty:2}:null}function m(e){const t=e.parentNode;if(!t)return null;let n=t.firstChild;if(!n)return null;let r=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&r++,n!==e);)n=n.nextSibling;return r}function d(e,t){return{name:e.name+`:nth-child(${t})`,penalty:e.penalty+1}}function p(e){return"html"!==e.name&&!e.name.startsWith("#")}function h(...e){const t=e.filter(y);return t.length>0?t:null}function y(e){return null!=e}function*g(e,t=[]){if(e.length>0)for(let n of e[0])yield*g(e.slice(1,e.length),t.concat(n));else yield t}function w(e){return[...e].sort(((e,t)=>i(e)-i(t)))}function*N(t,n,r={counter:0,visited:new Map}){if(t.length>2&&t.length>e.optimizedMinLength)for(let o=1;o<t.length-1;o++){if(r.counter>e.maxNumberOfTries)return;r.counter+=1;const i=[...t];i.splice(o,1);const u=l(i);if(r.visited.has(u))return;a(i)&&E(i,n)&&(yield i,r.visited.set(u,!0),yield*N(i,n,r))}}function E(e,n){return t.querySelector(l(e))===n}return window.Finder=function(o,i){if(n=new Date,o.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if("html"===o.tagName.toLowerCase())return"html";const a={root:document.body,idName:e=>!0,className:e=>!0,tagName:e=>!0,attr:(e,t)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4,timeoutMs:void 0};e={...a,...i},t=function(e,t){return e.nodeType===Node.DOCUMENT_NODE?e:e===t.root?e.ownerDocument:e}(e.root,a);let u=r(o,"all",(()=>r(o,"two",(()=>r(o,"one",(()=>r(o,"none")))))));if(u){const e=w(N(u,o));return e.length>0&&(u=e[0]),l(u)}throw new Error("Selector was not found.")},{}})()));